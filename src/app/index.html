<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PiCam Control</title>
    <link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="components/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" href="components/lightbox2/css/lightbox.css" />
    
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0px;
        font-family: 'Open Sans', Helvetica, Arial;
      }
      
      .container-fluid {
        margin-top: 30px;
      }

      .loading-image {
        height: 102%;
        filter: blur(4px);
        -webkit-filter: blur(4px);
        margin: -1% 0;
      }

      .btn .fa {
        margin-top: 7px;
      }

      #item-container {
        margin-top: 30px;
      }

      img.thumbnail {
        width: 133px;
        height: 100px;
        margin-right: 15px;
      }

    </style>
  </head>
  <body>

    <div class="clearfix"></div>

    <div class="container-fluid">
      
      <div class="col-xs-12 col-sm-12">

        <button class="btn btn-primary" id="take-picture">
          <i class="fa fa-camera fa-5x"></i>
        </button>

      </div>

      <div class="clearfix"></div>

      <div class="col-xs-12 col-sm-12" id="item-container">
        <!-- items will be here -->
      </div>

      <div class="clearfix"></div>

    </div>
    
    <script src="components/jquery/dist/jquery.min.js"></script>
    <script src="components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="components/lightbox2/js/lightbox.js"></script>

    <script>

      var itemIndex = 0;

      var addItemsToContainer = function(data) {

        var e = $('#item-container');

        $.each([].concat(data.files || data || []), function(index, file) {

          var tn = file.replace('.png', '_tn.png');

          var n = $(e).prepend('<div id="pi_cam_item_' + itemIndex + '" class="pull-left"><a href="' + file + '" data-lightbox="pi-cam-image"><img src="' + tn + '" class="thumbnail" /></a></div>');

          $('#pi_cam_item_' + itemIndex).hide().fadeIn(500);

          itemIndex++;

        });

      };

      $(function() {

        // get all the existing items
        $.ajax('get.items', {
          dataType: 'json'
        }).done(addItemsToContainer);

        $('#take-picture').on('click', function() {

          $.ajax('take.picture', {
            dataType: 'json'
          }).done(addItemsToContainer);

        })

      });

    </script>
  </body>
</html>